<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <link href="_server/css/editor.css" rel="stylesheet">
    <link href="_server/CodeMirror/codemirror.css" rel="stylesheet">
    <link href="_server/thirdparty/awesomplete.css" rel="stylesheet">
    <link href="_server/css/editor_mode.css" rel="stylesheet">
</head>
<body>
<script>
    if(innerWidth<innerHeight){ //pic:1242*2208 | chrome info:1340*2380
        confirm('高大于宽的设备请使用移动版本的editor, 点击确定跳转')?(window.location='./editor-mobile.html'):'';
    }
    if (location.protocol.indexOf("http")!=0) {
        alert("请在启动服务中打开本编辑器！不然包括编辑在内的绝大多数功能都无法使用。");
    }
</script>
<div class="main">
    <div id="left5" class='leftTab' style="z-index:-1;opacity: 0;"><!-- tower -->
        <h3 class="leftTabHeader">全塔属性&nbsp;&nbsp;<button onclick="editor.mode.onmode('save')">保存</button>&nbsp;&nbsp;<button onclick="editor.mode.changeDoubleClickModeByButton('add')">添加</button>&nbsp;&nbsp;<button onclick="editor_multi.editCommentJs('tower')">配置表格</button>
        </h3>
        <div class="leftTabContent">
            <div class='etable'>
                <table>
                    <tbody id='table_b6a03e4c_5968_4633_ac40_0dfdd2c9cde5'>
                    <tr>
                        <td>条目</td>
                        <td>注释</td>
                        <td>值</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div id="left6" class='leftTab' style="z-index:-1;opacity: 0;">
        <div style="position: relative; height: 95%"><!-- eventsEditor -->
            <h3>事件编辑器 &nbsp;&nbsp;
                <!--
                <button onclick="editor_blockly.showXML()">Show XML</button>
                <button onclick="editor_blockly.runCode()">console.log(obj=code)</button>
                -->
                <button onclick="editor_blockly.confirm()">确认</button>
                <button id='blocklyParse' onclick="editor_blockly.parse()">解析</button>
                <button onclick="editor_blockly.cancel()">取消</button>
                <div style="position: relative; display: inline-block; margin-left: 10px">
                    <div class="searchLogo"></div>
                    <input type="text" id="searchBlock" placeholder="搜索图块"/>
                </div>
                <button class="cpPanel" onclick="editor_blockly.selectPoint()" style="margin-left:5px">地图选点</button>
                <button class="cpPanel" onclick="editor.uievent.searchUsedFlags()" style="margin-left:5px">变量出现位置搜索</button>
                <input type="checkbox" class="cpPanel" id="blocklyReplace" onchange="editor_blockly.triggerReplace()" style="margin-left: 10px" />
                <span class="cpPanel" style="margin-left: -4px; font-size: 13px">开启中文名替换</span>
                <input type="checkbox" class="cpPanel" id="blocklyExpandCompare" onchange="editor_blockly.triggerExpandCompare()" style="margin-left: 10px" />
                <span class="cpPanel" style="margin-left: -4px; font-size: 13px">展开值块逻辑运算</span>
                <xml id="toolbox" style="display:none">
                </xml>
            </h3>
            <div style="position: relative;height: 100%">
                <div id="blocklyArea">
                    <div id="blocklyDiv"></div>
                </div>
                <textarea id="codeArea" spellcheck="false"></textarea>
            </div>
        </div>
    </div>
    <div id="colorPanel" class="cpPanel" style="display: none">
        <input class="color" id="colorPicker" value="255,215,0,1"/>
        <button onclick="confirmColor()">确定</button>
    </div>
    <div id="left7" style="z-index:-1;opacity: 0;"><!-- 多行文本编辑器 -->
        <button onclick="editor_multi.confirm()">确认</button>
        <button onclick="editor_multi.cancel()">取消</button>
        <button onclick="editor_multi.format()">格式化</button>
        <input type="checkbox" onclick="editor_multi.toggerLint()" id="lintCheckbox"
               style="vertical-align: bottom;margin-left:6px"/>
        <span style="vertical-align: bottom; margin-left: -3px">语法检查</span>
        <button onclick="editor_multi.showPlugins()" style="display: none; margin-top: 3px" id="showPlugins">显示云端插件列表</button>
        <textarea id="multiLineCode" name="multiLineCode"></textarea>
    </div>
    <div id="left8" class='leftTab' style="z-index:-1;opacity: 0;"><!-- functions -->
        <h3 class="leftTabHeader">脚本编辑&nbsp;&nbsp;<button onclick="editor.mode.onmode('save')">保存</button>&nbsp;&nbsp;<button onclick="editor_multi.editCommentJs('functions')">配置表格</button>
        </h3>
        <div class="leftTabContent">
            <div class='etable'>
                <table>
                    <tbody id='table_e260a2be_5690_476a_b04e_dacddede78b3'>
                    <tr>
                        <td>条目</td>
                        <td>注释</td>
                        <td>值</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div id="left9" class='leftTab' style="z-index:-1;opacity: 0;"><!-- commonevent -->
        <h3 class="leftTabHeader">公共事件&nbsp;&nbsp;<button onclick="editor.mode.onmode('save')">保存</button>&nbsp;&nbsp;<button onclick="editor.mode.changeDoubleClickModeByButton('add')">添加</button>&nbsp;&nbsp;<button onclick="editor.mode.changeDoubleClickModeByButton('delete')">删除</button>&nbsp;&nbsp;<button onclick="editor_multi.editCommentJs('commonevent')">配置表格</button>
        </h3>
        <div class="leftTabContent">
            <div class='etable'>
                <table>
                    <tbody id='table_b7bf0124_99fd_4af8_ae2f_0017f04a7c7d'>
                    <tr>
                        <td>条目</td>
                        <td>注释</td>
                        <td>值</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div id="left10" class='leftTab' style="z-index:-1;opacity: 0;"><!-- plugins -->
        <h3 class="leftTabHeader">插件编写&nbsp;&nbsp;<button onclick="editor.mode.onmode('save')">保存</button>&nbsp;&nbsp;<button onclick="editor.mode.changeDoubleClickModeByButton('add')">添加</button>&nbsp;&nbsp;<button onclick="editor.mode.changeDoubleClickModeByButton('delete')">删除</button>&nbsp;&nbsp;<button onclick="editor_multi.editCommentJs('plugins')">配置表格</button>
        </h3>
        <div class="leftTabContent">
            <div class='etable'>
                <table>
                    <tbody id='table_e2c034ec_47c6_48ae_8db8_4f8f32fea2d6'>
                    <tr>
                        <td>条目</td>
                        <td>注释</td>
                        <td>值</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div id="mid">
        <table class="col" id='mapColMark'></table>
        <table class="row" id='mapRowMark'></table>
        <div class="map" id="mapEdit">
            <canvas class='gameCanvas' id='efg' width='416' height='416'></canvas>
            <canvas class='gameCanvas' id='eui' width='416' height='416' style='z-index:100'></canvas>
        </div>
        <div class="tools">
            <div id="tip"></div>
            <select id="editModeSelect">
                <option value="map">地图编辑</option>
                <option value="loc">地图选点</option>
                <option value="enemyitem">图块属性</option>
                <option value="floor">楼层属性</option>
                <option value="tower">全塔属性</option>
                <option value="functions">脚本编辑</option>
                <option value="appendpic">追加素材</option>
                <option value="commonevent">公共事件</option>
                <option value="plugins">插件编写</option>
            </select>
            <span style="font-size: 12px"><input type="checkbox" id="lockMode"/>锁定模式</span>
            <br/>
            <span style="font-size: 12px;">
            <input type="radio" id="brushMod" name="brushMod" value="line" checked="checked" />线
            <input type="radio" id="brushMod2" name="brushMod" value="rectangle" />矩形
            <input type="radio" id="brushMod3" name="brushMod" value="tileset" />tileset平铺
            <input type="radio" id="brushMod4" name="brushMod" value="fill" />填充

            </span>
            <br/>
            <span style="font-size: 12px">
            <input type="radio" id="layerMod2" name="layerMod" value="bgmap" />背景层
            <input type="radio" id="layerMod" name="layerMod" value="map" checked="checked" style="margin-left: 5px" />事件层
            <input type="radio" id="layerMod3" name="layerMod" value="fgmap" style="margin-left: 5px" />前景层
            </span>
            <br>
            <div id="viewportButtons">
                <input type="button" value="←"/>
                <input type="button" value="↑"/>
                <input type="button" value="↓"/>
                <input type="button" value="→"/>
            </div>
            <br>
            <select id="selectFloor"></select>
            <input type="button" value="保存地图" id='saveFloor'/>
        </div>
    </div>
    <div id="mid2">
        <p style="margin: 10px"><span id='lastUsedTitle'></span><small>（Ctrl+滚轮放缩，右键置顶）</small> <button id='clearLastUsedBtn'>清除</button></p>
        <div class="map" id="lastUsedDiv">
            <canvas id='lastUsed' width='416' height='416' style="overflow: hidden"></canvas>
        </div>
    </div>
    <div id="right">
        <div id="iconLib">
            <div id="iconImages"></div>
            <div id="selectBox">
                <div id='dataSelection' style="display:none"></div>
            </div>
        </div>
        <button id="iconExpandBtn"></button>
    </div>
    <div id="menuDiv">
        <div id="midMenu" style="display:none">
            <div id='extraEvent' class='menuitem' style="display:none"><div class="menuitem-content"></div></div>
            <div id='chooseThis' class="menuitem"><div class="menuitem-content">选中此点</div></div>
            <div id='chooseInRight' class="menuitem"><div class="menuitem-content">在素材区选中此图块</div></div>
            <div id='copyLoc' class="menuitem"><div class="menuitem-content">复制此事件</div></div>
            <div id='pasteLoc' class="menuitem"><div class="menuitem-content">粘贴到此事件</div></div>
            <div id='clearEvent' class="menuitem"><div class="menuitem-content">仅清空此点事件</div></div>
            <div id='clearLoc' class="menuitem"><div class="menuitem-content">清空此点及事件</div></div>
        </div>
    </div>
</div>
<!-- <script>/* -->

<div id="gameInject" style='display: none'></div>

<!-- UI预览 & 地图选点 -->
<div id='uieventDiv' style='display: none'>
    <div id='uieventDialog'>
        <div id="uieventHead">
            <span id="uieventTitle"></span>
            <select id="uieventBackground" style="margin-left: 20px">
                <option value="thumbnail" selected>缩略图</option>
                <option value="#000000">黑色</option>
                <option value="#FFFFFF">白色</option>
            </select>
            <select id="uieventUsedFlags" style="margin-left: 10px; display: none" onchange="editor.uievent.doSearchUsedFlags()"></select>
            <button id="uieventNo">关闭</button>
            <button id="uieventYes">确定</button>
        </div>
        <hr style="clear: both; margin-top: 0"/>
        <div id='uieventBody'>
            <canvas class='gameCanvas' id='uievent' width='416' height='416'></canvas>
            <div id="selectPointBox"></div>
            <div id="uieventExtraBody" style="display: none; margin-top: -10px"></div>
        </div>
        <div id="selectPoint">
            <select id="selectPointFloor"></select>
            <div id="selectPointButtons">
                <input type="button" value="←"/>
                <input type="button" value="↑"/>
                <input type="button" value="↓"/>
                <input type="button" value="→"/>
            </div>
        </div>
    </div>
</div>


<!-- */</script> -->

<!-- =========================================================== -->

<!-- <script src='_server/vendor/vue.min.js'></script> -->
<!-- <script src="https://cdn.bootcss.com/vue/2.5.13/vue.js"></script> -->
<!-- <script src='_server/vendor/polyfill.min.js'></script> -->
<script src='_server/fs.js'></script>
<script src='_server/editor_config.js'></script>
<script src='_server/editor_util.js'></script>
<script src='_server/editor_game.js'></script>
<script src='_server/editor_file.js'></script>
<script src='_server/editor_table.js'></script>
<script src='_server/editor_mode.js'></script>
<script src='_server/editor_ui.js'></script>
<script src='_server/editor_mappanel.js'></script>
<script src='_server/editor_datapanel.js'></script>
<script src='_server/editor_materialpanel.js'></script>
<script src='_server/editor_listen.js'></script>
<script src='libs/thirdparty/lz-string.min.js'></script>
<script src='libs/thirdparty/localforage.min.js'></script>
<script src='libs/thirdparty/zip.min.js'></script>
<script src='_server/editor.js'></script>
<script>
    editor.init(function () {
        editor.listen();
        editor.mode_listen();
        editor.mobile_listen();
    });
    //main.listen();
</script>

<!-- hightlight textarea -->
<script src='_server/editor_multi.js'></script>
<!-- blockly -->
<script src="_server/blockly/Converter.bundle.min.js"></script>
<script src="_server/blockly/blockly_compressed.js"></script>
<script src="_server/blockly/blocks_compressed.js"></script>
<script src="_server/blockly/javascript_compressed.js"></script>
<script src="_server/blockly/zh-hans.js"></script>
<script src='_server/MotaActionParser.js'></script>
<script src='_server/editor_blocklyconfig.js'></script>
<script src='_server/editor_blockly.js'></script>
<!-- codemirror -->
<script src="_server/CodeMirror/codeMirror.bundle.min.js"></script>
<script src="_server/CodeMirror/jshint.min.js"></script>
<script src="_server/CodeMirror/beautify.min.js"></script>
<script src="_server/CodeMirror/codeMirror.plugin.min.js"></script>
<!-- thirdparty -->
<script src="_server/thirdparty/color.all.min.js"></script>
<script src="_server/thirdparty/awesomplete.min.js"></script>
<script src="_server/thirdparty/caret-position.js"></script>
<script src="_server/thirdparty/jsColor.js"></script>

</body>
</html>
